import Head from "next/head";
import axios from "axios";
import { getSession } from "next-auth/react";
import { env } from "~/env.mjs";

import type { GetServerSidePropsContext, NextPage } from "next";
import type { User } from "@prisma/client";
import type { Session } from "next-auth";

import BetStation from "~/components/BetStation";
import RouletteSpinner from "~/components/RouletteSpinner";
import RouletteStatusBar from "~/components/RouletteStatusBar";

type Props = {
  session: Session;
  balance: number;
};

export const getServerSideProps = async (
  context: GetServerSidePropsContext
) => {
  const session = await getSession(context);
  if (!session) {
    return {
      redirect: {
        destination: "/auth/signin",
      },
    };
  }

  const res: {
    data: {
      user: User;
    };
  } = await axios.get(`${env.NEXTAUTH_URL}/api/user/${session.user.id}`);

  return {
    props: { session, balance: res.data.user.balance },
  };
};

const RoulettePage: NextPage<Props> = ({ balance }) => {
  return (
    <>
      <Head>
        <title>Roulettor</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="relative mx-auto flex min-h-screen max-w-6xl flex-col gap-4">
        <RouletteSpinner />
        <RouletteStatusBar totalTimeInSeconds={60} />
        {/* <RoulettePanel /> */}
        <BetStation balance={balance} game="roulette" />
      </main>
    </>
  );
};

export default RoulettePage;
